# 教师实验室网站部署指南

## 服务器配置要求

### 最低配置（当前）
- ✅ CPU: 2核（够用）
- ⚠️ 内存: 2G（建议升级到4G）
- ✅ 硬盘: 40G（足够）
- ✅ 带宽: 200MBPS（足够）

### 推荐配置
- CPU: 2核
- 内存: 4G（更稳定）
- 硬盘: 40G
- 带宽: 200MBPS

## 一、服务器环境准备（国内服务器）

### 1. 选择操作系统镜像
推荐使用：**Ubuntu 22.04 LTS** 或 **CentOS 7.9**

国内云服务器提供商镜像选择：
- **阿里云**：Ubuntu 22.04 LTS 64位
- **腾讯云**：Ubuntu 22.04 LTS 64位
- **华为云**：Ubuntu 22.04 LTS 64位

### 2. 系统初始化（首次登录后执行）

```bash
# 更新系统
sudo apt update && sudo apt upgrade -y

# 安装基础工具
sudo apt install -y curl wget git vim

# 配置防火墙（开放80和443端口）
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 22/tcp
sudo ufw enable
```

### 3. 安装 Node.js（使用国内镜像）

```bash
# 方法1：使用NodeSource（推荐，版本新）
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# 方法2：使用淘宝镜像（更快）
# 先安装nvm
curl -o- https://gitee.com/mirrors/nvm/raw/master/install.sh | bash
source ~/.bashrc
nvm install 18
nvm use 18

# 配置npm国内镜像
npm config set registry https://registry.npmmirror.com
npm config get registry  # 验证是否成功
```

### 4. 安装 Nginx

```bash
sudo apt install -y nginx

# 启动并设置开机自启
sudo systemctl start nginx
sudo systemctl enable nginx

# 检查状态
sudo systemctl status nginx
```

## 二、项目部署步骤

### 1. 创建网站目录

```bash
# 创建主目录
sudo mkdir -p /var/www/teacherlab
sudo chown -R $USER:$USER /var/www/teacherlab
cd /var/www/teacherlab
```

### 2. 上传项目文件

**方式1：使用Git（推荐）**
```bash
# 如果项目在Git仓库
git clone <你的仓库地址> .

# 或者使用GitHub/Gitee
git clone https://gitee.com/your-username/teacherlab.git .
```

**方式2：使用SCP上传**
```bash
# 在本地电脑执行（Windows PowerShell）
scp -r "D:\teacherlab教师实验室\*" root@你的服务器IP:/var/www/teacherlab/
```

**方式3：使用FTP工具**
- 推荐工具：WinSCP、FileZilla
- 连接后上传整个项目文件夹

### 3. 构建前端项目

```bash
cd /var/www/teacherlab

# 构建Vue3项目（背诵管理统计系统）
cd 背诵管理统计系统
npm install
npm run build
cd ..

# 构建React项目（PDF习题转PPT）
cd 习题转ppt/teacher-ppt-splitter2
npm install
npm run build
cd ../..
```

### 4. 配置 Nginx

创建Nginx配置文件：

```bash
sudo nano /etc/nginx/sites-available/teacherlab
```

配置文件内容：

```nginx
# 教师实验室主站
server {
    listen 80;
    server_name your-domain.com;  # 替换为你的域名或IP
    
    root /var/www/teacherlab/teacherelab;
    index index.html;
    
    location / {
        try_files $uri $uri/ =404;
    }
    
    # 静态资源缓存
    location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}

# 背诵管理（旧版HTML）
server {
    listen 80;
    server_name recitation.your-domain.com;  # 或使用IP+路径
    
    root /var/www/teacherlab/背诵管理;
    index index.html;
    
    location / {
        try_files $uri $uri/ =404;
    }
}

# 背诵管理统计系统（Vue3构建版）
server {
    listen 80;
    server_name recitation-vue.your-domain.com;
    
    root /var/www/teacherlab/背诵管理统计系统/dist;
    index index.html;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # 静态资源
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}

# PDF习题转PPT（React构建版）
server {
    listen 80;
    server_name ppt.your-domain.com;
    
    root /var/www/teacherlab/习题转ppt/teacher-ppt-splitter2/dist;
    index index.html;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # 静态资源
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}

# 错题统计
server {
    listen 80;
    server_name mistakes.your-domain.com;
    
    root /var/www/teacherlab/错题统计;
    index index.html;
    
    location / {
        try_files $uri $uri/ =404;
    }
}
```

**如果没有多个域名，可以使用路径方式：**

```nginx
server {
    listen 80;
    server_name your-domain.com;  # 或直接使用IP
    
    root /var/www/teacherlab;
    index index.html;
    
    # 主站
    location = / {
        root /var/www/teacherlab/teacherelab;
        try_files /index.html =404;
    }
    
    # 教师实验室
    location /lab {
        alias /var/www/teacherlab/teacherelab;
        try_files $uri $uri/ =404;
        index index.html;
    }
    
    # 背诵管理（旧版）
    location /recitation {
        alias /var/www/teacherlab/背诵管理;
        try_files $uri $uri/ =404;
        index index.html;
    }
    
    # 背诵管理统计系统（Vue3）
    location /recitation-vue {
        alias /var/www/teacherlab/背诵管理统计系统/dist;
        try_files $uri $uri/ /recitation-vue/index.html;
        index index.html;
    }
    
    # PDF转PPT
    location /ppt {
        alias /var/www/teacherlab/习题转ppt/teacher-ppt-splitter2/dist;
        try_files $uri $uri/ /ppt/index.html;
        index index.html;
    }
    
    # 错题统计
    location /mistakes {
        alias /var/www/teacherlab/错题统计;
        try_files $uri $uri/ =404;
        index index.html;
    }
    
    # 静态资源缓存
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2)$ {
        expires 30d;
        add_header Cache-Control "public";
    }
}
```

启用配置：

```bash
# 创建软链接
sudo ln -s /etc/nginx/sites-available/teacherlab /etc/nginx/sites-enabled/

# 测试配置
sudo nginx -t

# 重载Nginx
sudo systemctl reload nginx
```

## 三、域名配置（可选）

如果没有域名，可以直接使用IP访问。

如果有域名：
1. 在域名服务商处添加A记录，指向服务器IP
2. 等待DNS解析生效（通常几分钟到几小时）

## 四、SSL证书配置（HTTPS，可选但推荐）

使用Let's Encrypt免费证书：

```bash
# 安装Certbot
sudo apt install -y certbot python3-certbot-nginx

# 申请证书（需要域名）
sudo certbot --nginx -d your-domain.com

# 自动续期测试
sudo certbot renew --dry-run
```

## 五、性能优化

### 1. 启用Gzip压缩

编辑 `/etc/nginx/nginx.conf`，在 `http` 块中添加：

```nginx
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;
```

### 2. 限制并发连接

在 `http` 块中添加：

```nginx
limit_conn_zone $binary_remote_addr zone=conn_limit_per_ip:10m;
limit_conn conn_limit_per_ip 20;
```

## 六、监控和维护

### 查看Nginx日志
```bash
# 访问日志
sudo tail -f /var/log/nginx/access.log

# 错误日志
sudo tail -f /var/log/nginx/error.log
```

### 查看系统资源
```bash
# CPU和内存使用
htop  # 需要先安装: sudo apt install htop

# 磁盘使用
df -h
```

### 更新项目
```bash
cd /var/www/teacherlab

# 如果使用Git
git pull

# 重新构建
cd 背诵管理统计系统 && npm run build
cd ../习题转ppt/teacher-ppt-splitter2 && npm run build

# 重载Nginx
sudo systemctl reload nginx
```

## 七、常见问题

### 1. 502 Bad Gateway
- 检查Nginx配置是否正确
- 检查文件权限：`sudo chown -R www-data:www-data /var/www/teacherlab`

### 2. 403 Forbidden
- 检查目录权限：`sudo chmod -R 755 /var/www/teacherlab`
- 检查Nginx配置中的root路径是否正确

### 3. 内存不足
- 如果2G内存不够，考虑：
  - 升级到4G内存
  - 使用PM2管理Node.js进程（如果运行Node服务）
  - 优化Nginx worker进程数

### 4. 构建失败
- 检查Node.js版本：`node -v`（需要18+）
- 清理缓存：`npm cache clean --force`
- 删除node_modules重新安装

## 八、快速部署脚本

创建一键部署脚本 `deploy.sh`：

```bash
#!/bin/bash
set -e

echo "开始部署教师实验室..."

# 1. 更新系统
echo "更新系统..."
sudo apt update

# 2. 安装Node.js（如果未安装）
if ! command -v node &> /dev/null; then
    echo "安装Node.js..."
    curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
    sudo apt install -y nodejs
    npm config set registry https://registry.npmmirror.com
fi

# 3. 安装Nginx（如果未安装）
if ! command -v nginx &> /dev/null; then
    echo "安装Nginx..."
    sudo apt install -y nginx
fi

# 4. 创建目录
echo "创建目录..."
sudo mkdir -p /var/www/teacherlab
sudo chown -R $USER:$USER /var/www/teacherlab

# 5. 构建项目
echo "构建Vue3项目..."
cd 背诵管理统计系统
npm install
npm run build
cd ..

echo "构建React项目..."
cd 习题转ppt/teacher-ppt-splitter2
npm install
npm run build
cd ../..

# 6. 配置Nginx
echo "配置Nginx..."
# 这里需要手动配置nginx配置文件

echo "部署完成！"
echo "请手动配置Nginx并重载: sudo systemctl reload nginx"
```

## 总结

✅ **配置评估**：
- 2核CPU：✅ 够用
- 2G内存：⚠️ 勉强够用，建议4G
- 40G硬盘：✅ 足够
- 200MBPS带宽：✅ 足够

✅ **推荐镜像**：Ubuntu 22.04 LTS（国内镜像源）

✅ **核心软件**：
- Node.js 18+（构建工具）
- Nginx（Web服务器）
- Git（代码管理）

部署后，你的网站就可以通过IP或域名访问了！



