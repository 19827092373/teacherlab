# TeacherLab.cn 部署流程图

## 🎯 完整部署流程（按顺序执行）

```
┌─────────────────────────────────────────────────────────┐
│  第一步：服务器准备（先做这个！）                        │
├─────────────────────────────────────────────────────────┤
│  1. 购买/准备服务器（2核2G/4G，40G硬盘）                │
│  2. 选择操作系统：CentOS 7.9 或 Ubuntu 22.04           │
│  3. 安装宝塔面板                                        │
│  4. 登录宝塔面板（http://服务器IP:8888）                │
│  5. 安装LNMP环境（Nginx + Node.js）                     │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│  第二步：在宝塔中创建网站（用IP测试）                    │
├─────────────────────────────────────────────────────────┤
│  主站：teacherlab.cn                                       │
│  ├─ 创建网站（域名先填teacherlab.cn）                     │
│  ├─ 克隆Git仓库（teachlab仓库）                          │
│  └─ 设置网站目录                                        │
│                                                          │
│  工具1：ppt.teacherlab.cn                                  │
│  ├─ 创建网站                                            │
│  ├─ 上传PDF转PPT项目文件                                │
│  ├─ SSH构建：npm install && npm run build               │
│  └─ 设置网站目录为 /dist                                │
│                                                          │
│  工具2：mistakes.teacherlab.cn                             │
│  ├─ 创建网站                                            │
│  └─ 上传错题统计文件夹                                  │
│                                                          │
│  工具3：recitation.teacherlab.cn                           │
│  ├─ 创建网站                                            │
│  ├─ 上传背诵管理统计系统文件                            │
│  ├─ SSH构建：npm install && npm run build               │
│  └─ 设置网站目录为 /dist                                │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│  第三步：测试访问（用IP）                                │
├─────────────────────────────────────────────────────────┤
│  在浏览器访问：                                          │
│  http://服务器IP/teacherlab.cn                             │
│  http://服务器IP/ppt.teacherlab.cn                         │
│  http://服务器IP/mistakes.teacherlab.cn                    │
│  http://服务器IP/recitation.teacherlab.cn                  │
│                                                          │
│  ✅ 确认所有网站都可以正常访问                           │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│  第四步：配置DNS解析（现在可以配置了！）                 │
├─────────────────────────────────────────────────────────┤
│  在域名服务商处添加A记录：                               │
│                                                          │
│  @ → 服务器IP（主域名 teacherlab.cn）                      │
│  ppt → 服务器IP（ppt.teacherlab.cn）                       │
│  mistakes → 服务器IP（mistakes.teacherlab.cn）             │
│  recitation → 服务器IP（recitation.teacherlab.cn）          │
│                                                          │
│  等待DNS生效（5-30分钟）                                 │
│  使用 nslookup teacherlab.cn 验证                         │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│  第五步：测试域名访问                                    │
├─────────────────────────────────────────────────────────┤
│  访问：                                                  │
│  http://teacherlab.cn                                      │
│  http://ppt.teacherlab.cn                                  │
│  http://mistakes.teacherlab.cn                             │
│  http://recitation.teacherlab.cn                           │
│                                                          │
│  ✅ 确认所有域名都可以正常访问                           │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│  第六步：配置SSL证书（HTTPS）                            │
├─────────────────────────────────────────────────────────┤
│  在宝塔面板中：                                          │
│  1. 网站 → 选择网站 → 设置 → SSL                        │
│  2. 选择 Let's Encrypt                                  │
│  3. 填写域名并申请证书                                   │
│  4. 开启"强制HTTPS"                                      │
│                                                          │
│  为每个网站单独申请证书：                                │
│  - teacherlab.cn                                          │
│  - ppt.teacherlab.cn                                      │
│  - mistakes.teacherlab.cn                                 │
│  - recitation.teacherlab.cn                               │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│  第七步：完成！✅                                        │
├─────────────────────────────────────────────────────────┤
│  访问地址：                                              │
│  https://teacherlab.cn              → 主站                 │
│  https://ppt.teacherlab.cn          → PDF转PPT             │
│  https://mistakes.teacherlab.cn     → 错题管理             │
│  https://recitation.teacherlab.cn   → 背诵管理             │
└─────────────────────────────────────────────────────────┘
```

---

## ⚠️ 重要提醒

### ✅ 正确顺序
1. **先配置服务器和宝塔**（可以用IP测试）
2. **再配置DNS解析**（域名指向服务器）
3. **最后配置SSL**（HTTPS）

### ❌ 错误顺序
- ❌ 先配置DNS → 服务器还没准备好 → 域名无法访问
- ❌ 先配置SSL → DNS还没解析 → 证书申请失败

---

## 📋 快速检查清单

### 服务器准备阶段
- [ ] 服务器已购买/准备
- [ ] 操作系统已选择（CentOS 7.9 或 Ubuntu 22.04）
- [ ] 宝塔面板已安装
- [ ] 可以登录宝塔面板
- [ ] LNMP环境已安装
- [ ] Node.js已安装并配置国内镜像

### 网站部署阶段
- [ ] 主站网站已创建
- [ ] 主站代码已克隆/上传
- [ ] PDF转PPT网站已创建并构建
- [ ] 错题管理网站已创建
- [ ] 背诵管理网站已创建并构建
- [ ] 所有网站可以用IP访问

### DNS配置阶段
- [ ] DNS解析记录已添加（4条A记录）
- [ ] DNS已生效（nslookup验证）
- [ ] 所有域名可以HTTP访问

### SSL配置阶段
- [ ] SSL证书已申请（4个域名）
- [ ] 强制HTTPS已开启
- [ ] 所有网站可以HTTPS访问

---

## 🚀 预计时间

- **服务器准备**：30-60分钟（包括安装宝塔和LNMP）
- **网站部署**：30-60分钟（包括构建项目）
- **DNS解析**：5-30分钟（等待生效）
- **SSL配置**：10-20分钟（申请证书）

**总计**：约2-3小时（首次部署）

---

## 📞 遇到问题？

1. **查看详细文档**：
   - `宝塔面板部署指南.md` - 详细步骤
   - `DNS解析配置说明.md` - DNS配置详解

2. **检查日志**：
   - 宝塔面板 → 日志 → 网站日志
   - SSH：`tail -f /www/server/nginx/logs/error.log`

3. **常见问题**：
   - DNS未生效 → 等待更长时间或检查记录值
   - 网站无法访问 → 检查防火墙和端口
   - 构建失败 → 检查Node.js和npm镜像配置

---

祝部署顺利！🎉

